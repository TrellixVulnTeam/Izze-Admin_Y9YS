{"ast":null,"code":"import _regeneratorRuntime from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import firebase from'firebase';import React,{useEffect,useState}from'react';import{Outlet,useNavigate}from'react-router-dom';import Loader from'../../components/Loader/Loader';import TopNavBar from'../../components/TopNavBar/TopNavBar';import useService from'../../hook/useService';import useSnackbar from'../../hook/useSnackbar';import{useStore}from'../../Mobx/Helpers/UseStore';import{SigninRoute}from'../../Routes/RoutesConstants';import{AuthStateChange}from'../../utils/FirebaseUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var HomeLayout=function HomeLayout(){var _useService=useService(),Post=_useService.Post,Logout=_useService.Logout;var _useStore=useStore(),UserStore=_useStore.UserStore;var Snackbar=useSnackbar();var navigate=useNavigate();var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var authStateChanged=function authStateChanged(user){setLoading(true);if(user){localStorage.setItem('uid',user.uid);UserStore.setIdToken(user.uid);Post('app/login').then(function(res){console.log('login Res',res);setLoading(false);}).catch(function(err){console.log('login err',err.statusCode);Snackbar.show(err.message,'error');Logout().then(function(){return navigate(SigninRoute);});});}else{Logout().then(function(){return navigate(SigninRoute);});}};useEffect(function(){var unsubscribe=AuthStateChange(authStateChanged);return function(){return unsubscribe();};},[]);useEffect(function(){var unsubscribe=firebase.auth().onIdTokenChanged(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user){var idToken;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return user.getIdToken();case 2:idToken=_context.sent;case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());return function(){return unsubscribe();};},[]);useEffect(function(){var handle=setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var user;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:user=firebase.auth().currentUser;if(!user){_context2.next=4;break;}_context2.next=4;return user.getIdToken(true);case 4:case\"end\":return _context2.stop();}}},_callee2);})),58*60*1000);return function(){return clearInterval(handle);};},[]);return/*#__PURE__*/_jsx(_Fragment,{children:loading?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsx(TopNavBar,{children:/*#__PURE__*/_jsx(Outlet,{})})});};export default HomeLayout;","map":{"version":3,"sources":["D:/Pyramidion/WebApp/Izze-Admin/src/pages/Layouts/HomeLayout.tsx"],"names":["firebase","React","useEffect","useState","Outlet","useNavigate","Loader","TopNavBar","useService","useSnackbar","useStore","SigninRoute","AuthStateChange","HomeLayout","Post","Logout","UserStore","Snackbar","navigate","loading","setLoading","authStateChanged","user","localStorage","setItem","uid","setIdToken","then","res","console","log","catch","err","statusCode","show","message","unsubscribe","auth","onIdTokenChanged","getIdToken","idToken","handle","setInterval","currentUser","clearInterval"],"mappings":"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","sourcesContent":["import firebase from 'firebase';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Outlet, useNavigate } from 'react-router-dom';\r\nimport Loader from '../../components/Loader/Loader';\r\nimport TopNavBar from '../../components/TopNavBar/TopNavBar';\r\nimport useService from '../../hook/useService';\r\nimport useSnackbar from '../../hook/useSnackbar';\r\nimport { useStore } from '../../Mobx/Helpers/UseStore';\r\nimport { SigninRoute } from '../../Routes/RoutesConstants';\r\nimport { AuthStateChange, onIdTokenChanged } from '../../utils/FirebaseUtils';\r\n\r\nconst HomeLayout = () => {\r\n  const { Post, Logout } = useService()\r\n  const { UserStore } = useStore()\r\n  const Snackbar = useSnackbar()\r\n  const navigate = useNavigate()\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  const authStateChanged = (user: any) => {\r\n    setLoading(true)\r\n    if (user) {\r\n      localStorage.setItem('uid', user.uid);\r\n      UserStore.setIdToken(user.uid);\r\n      Post('app/login').then((res: any) => {\r\n        console.log('login Res', res)\r\n        setLoading(false)\r\n      }).catch((err: any) => {\r\n        console.log('login err', err.statusCode)\r\n        Snackbar.show(err.message, 'error');\r\n        Logout().then(() => navigate(SigninRoute))\r\n      })\r\n    } else {\r\n      Logout().then(() => navigate(SigninRoute))\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = AuthStateChange(authStateChanged);\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = firebase.auth().onIdTokenChanged(async (user: any) => {\r\n      const idToken = await user.getIdToken()\r\n    });\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const handle = setInterval(async () => {\r\n      const user = firebase.auth().currentUser;\r\n      if (user) await user.getIdToken(true);\r\n    }, 58 * 60 * 1000);\r\n    return () => clearInterval(handle);\r\n  }, []);\r\n\r\n  return (\r\n\r\n    <>\r\n      {loading ? <Loader /> : <TopNavBar>\r\n        <Outlet />\r\n      </TopNavBar>}\r\n    </>\r\n\r\n  );\r\n};\r\n\r\nexport default HomeLayout;\r\n"]},"metadata":{},"sourceType":"module"}