{"ast":null,"code":"import { Mark, mergeAttributes, markPasteRule } from '@tiptap/core';\nimport { Plugin, PluginKey } from 'prosemirror-state';\n/**\r\n * A regex that matches any string that contains a link\r\n */\n\nvar pasteRegex = /https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z]{2,}\\b(?:[-a-zA-Z0-9@:%._+~#=?!&/]*)(?:[-a-zA-Z0-9@:%._+~#=?!&/]*)/gi;\n/**\r\n * A regex that matches an url\r\n */\n\nvar pasteRegexExact = /^https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z]{2,}\\b(?:[-a-zA-Z0-9@:%._+~#=?!&/]*)(?:[-a-zA-Z0-9@:%._+~#=?!&/]*)$/gi;\nvar Link = Mark.create({\n  name: 'link',\n  priority: 1000,\n  inclusive: false,\n  defaultOptions: {\n    openOnClick: true,\n    linkOnPaste: true,\n    HTMLAttributes: {\n      target: '_blank',\n      rel: 'noopener noreferrer nofollow'\n    }\n  },\n  addAttributes: function addAttributes() {\n    return {\n      href: {\n        default: null\n      },\n      target: {\n        default: this.options.HTMLAttributes.target\n      }\n    };\n  },\n  parseHTML: function parseHTML() {\n    return [{\n      tag: 'a[href]'\n    }];\n  },\n  renderHTML: function renderHTML(_ref) {\n    var HTMLAttributes = _ref.HTMLAttributes;\n    return ['a', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0];\n  },\n  addCommands: function addCommands() {\n    return {\n      setLink: function setLink(attributes) {\n        return function (_ref2) {\n          var commands = _ref2.commands;\n          return commands.setMark('link', attributes);\n        };\n      },\n      toggleLink: function toggleLink(attributes) {\n        return function (_ref3) {\n          var commands = _ref3.commands;\n          return commands.toggleMark('link', attributes);\n        };\n      },\n      unsetLink: function unsetLink() {\n        return function (_ref4) {\n          var commands = _ref4.commands;\n          return commands.unsetMark('link');\n        };\n      }\n    };\n  },\n  addPasteRules: function addPasteRules() {\n    return [markPasteRule(pasteRegex, this.type, function (match) {\n      return {\n        href: match[0]\n      };\n    })];\n  },\n  addProseMirrorPlugins: function addProseMirrorPlugins() {\n    var _this = this;\n\n    var plugins = [];\n\n    if (this.options.openOnClick) {\n      plugins.push(new Plugin({\n        key: new PluginKey('handleClickLink'),\n        props: {\n          handleClick: function handleClick(view, pos, event) {\n            var _a;\n\n            var attrs = _this.editor.getAttributes('link');\n\n            var link = (_a = event.target) === null || _a === void 0 ? void 0 : _a.closest('a');\n\n            if (link && attrs.href) {\n              window.open(attrs.href, attrs.target);\n              return true;\n            }\n\n            return false;\n          }\n        }\n      }));\n    }\n\n    if (this.options.linkOnPaste) {\n      plugins.push(new Plugin({\n        key: new PluginKey('handlePasteLink'),\n        props: {\n          handlePaste: function handlePaste(view, event, slice) {\n            var state = view.state;\n            var selection = state.selection;\n            var empty = selection.empty;\n\n            if (empty) {\n              return false;\n            }\n\n            var textContent = '';\n            slice.content.forEach(function (node) {\n              textContent += node.textContent;\n            });\n\n            if (!textContent || !textContent.match(pasteRegexExact)) {\n              return false;\n            }\n\n            _this.editor.commands.setMark(_this.type, {\n              href: textContent\n            });\n\n            return true;\n          }\n        }\n      }));\n    }\n\n    return plugins;\n  }\n});\nexport default Link;\nexport { Link, pasteRegex, pasteRegexExact };","map":{"version":3,"sources":["../src/link.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Mark,\n  markPasteRule,\n  mergeAttributes,\n} from '@tiptap/core'\nimport { Plugin, PluginKey } from 'prosemirror-state'\n\nexport interface LinkOptions {\n  /**\n   * If enabled, links will be opened on click.\n   */\n  openOnClick: boolean,\n  /**\n   * Adds a link to the current selection if the pasted content only contains an url.\n   */\n  linkOnPaste: boolean,\n  /**\n   * A list of HTML attributes to be rendered.\n   */\n  HTMLAttributes: Record<string, any>,\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    link: {\n      /**\n       * Set a link mark\n       */\n      setLink: (attributes: { href: string, target?: string }) => ReturnType,\n      /**\n       * Toggle a link mark\n       */\n      toggleLink: (attributes: { href: string, target?: string }) => ReturnType,\n      /**\n       * Unset a link mark\n       */\n      unsetLink: () => ReturnType,\n    }\n  }\n}\n\n/**\n * A regex that matches any string that contains a link\n */\nexport const pasteRegex = /https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z]{2,}\\b(?:[-a-zA-Z0-9@:%._+~#=?!&/]*)(?:[-a-zA-Z0-9@:%._+~#=?!&/]*)/gi\n\n/**\n * A regex that matches an url\n */\nexport const pasteRegexExact = /^https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z]{2,}\\b(?:[-a-zA-Z0-9@:%._+~#=?!&/]*)(?:[-a-zA-Z0-9@:%._+~#=?!&/]*)$/gi\n\nexport const Link = Mark.create<LinkOptions>({\n  name: 'link',\n\n  priority: 1000,\n\n  inclusive: false,\n\n  defaultOptions: {\n    openOnClick: true,\n    linkOnPaste: true,\n    HTMLAttributes: {\n      target: '_blank',\n      rel: 'noopener noreferrer nofollow',\n    },\n  },\n\n  addAttributes() {\n    return {\n      href: {\n        default: null,\n      },\n      target: {\n        default: this.options.HTMLAttributes.target,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      { tag: 'a[href]' },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return ['a', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0]\n  },\n\n  addCommands() {\n    return {\n      setLink: attributes => ({ commands }) => {\n        return commands.setMark('link', attributes)\n      },\n      toggleLink: attributes => ({ commands }) => {\n        return commands.toggleMark('link', attributes)\n      },\n      unsetLink: () => ({ commands }) => {\n        return commands.unsetMark('link')\n      },\n    }\n  },\n\n  addPasteRules() {\n    return [\n      markPasteRule(pasteRegex, this.type, match => ({ href: match[0] })),\n    ]\n  },\n\n  addProseMirrorPlugins() {\n    const plugins = []\n\n    if (this.options.openOnClick) {\n      plugins.push(\n        new Plugin({\n          key: new PluginKey('handleClickLink'),\n          props: {\n            handleClick: (view, pos, event) => {\n              const attrs = this.editor.getAttributes('link')\n              const link = (event.target as HTMLElement)?.closest('a')\n\n              if (link && attrs.href) {\n                window.open(attrs.href, attrs.target)\n\n                return true\n              }\n\n              return false\n            },\n          },\n        }),\n      )\n    }\n\n    if (this.options.linkOnPaste) {\n      plugins.push(\n        new Plugin({\n          key: new PluginKey('handlePasteLink'),\n          props: {\n            handlePaste: (view, event, slice) => {\n              const { state } = view\n              const { selection } = state\n              const { empty } = selection\n\n              if (empty) {\n                return false\n              }\n\n              let textContent = ''\n\n              slice.content.forEach(node => {\n                textContent += node.textContent\n              })\n\n              if (!textContent || !textContent.match(pasteRegexExact)) {\n                return false\n              }\n\n              this.editor.commands.setMark(this.type, {\n                href: textContent,\n              })\n\n              return true\n            },\n          },\n        }),\n      )\n    }\n\n    return plugins\n  },\n})\n"]},"metadata":{},"sourceType":"module"}