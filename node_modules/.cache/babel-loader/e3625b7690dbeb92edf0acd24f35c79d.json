{"ast":null,"code":"import _regeneratorRuntime from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectWithoutProperties from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _objectSpread from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{Grid,Button,Paper,makeStyles,Avatar,Table,TableBody,TableCell,TableRow,IconButton,Dialog,DialogActions,DialogContent,TextField}from'@material-ui/core';import Page from'../../components/Page/Page';import useService from'../../hook/useService';import useSnackbar from'../../hook/useSnackbar';import EditIcon from'@material-ui/icons/Edit';import CircularProgress from'@material-ui/core/CircularProgress';import DialogTitle from'../../components/DialogTitlle/DialogTitle';import{Formik}from'formik';import*as Yup from'yup';import{uploadNewImage}from'../../utils/CloudinaryUtils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyle=makeStyles(function(theme){return{root:{width:theme.breakpoints.values.lg,height:'100%',maxWidth:'100%',margin:'0 auto',padding:theme.spacing(3)},paperStyle:{padding:theme.spacing(8,8)},insidePaperDivStyle:{display:'flex',flexDirection:'column',justifyContent:'center',margin:'auto',alignItems:'center',height:'100%'},themeButton:{color:theme.palette.white,// textTransform: 'capitalize',\nbackgroundColor:theme.palette.green.main,'&:hover':{backgroundColor:theme.palette.green.dark}},avatarStyle:{width:'150px',height:'150px'},lColor:{color:theme.palette.green.main}};});var AdminProfileDetails=function AdminProfileDetails(){var _profileData$image;var classes=useStyle();var _useService=useService(),Post=_useService.Post;var Snackbar=useSnackbar();var _React$useState=React.useState(''),_React$useState2=_slicedToArray(_React$useState,2),profileData=_React$useState2[0],setProfileData=_React$useState2[1];var _React$useState3=React.useState(true),_React$useState4=_slicedToArray(_React$useState3,2),isLoading=_React$useState4[0],setIsLoading=_React$useState4[1];var getProfileDetails=function getProfileDetails(){setIsLoading(true);Post('app/getAdminUser',{}).then(function(res){setIsLoading(false);if(!res.error){setProfileData(res.data);}else{Snackbar.show(res.message,'error');}}).catch(function(err){setIsLoading(false);Snackbar.show(err.message,'error');});};React.useEffect(function(){getProfileDetails();},[]);return/*#__PURE__*/_jsxs(\"div\",{className:classes.root,children:[/*#__PURE__*/_jsx(Page,{title:\"Admin Profile\"}),/*#__PURE__*/_jsxs(Grid,{container:true,children:[/*#__PURE__*/_jsx(Grid,{xs:true,md:true,item:true}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:8,children:/*#__PURE__*/_jsxs(Paper,{className:classes.paperStyle,children:[!isLoading&&/*#__PURE__*/_jsxs(\"div\",{className:classes.insidePaperDivStyle,children:[/*#__PURE__*/_jsx(Avatar,{className:classes.avatarStyle,src:profileData===null||profileData===void 0?void 0:(_profileData$image=profileData.image)===null||_profileData$image===void 0?void 0:_profileData$image.url,alt:profileData===null||profileData===void 0?void 0:profileData.name,variant:\"square\"}),/*#__PURE__*/_jsx(Table,{children:/*#__PURE__*/_jsxs(TableBody,{children:[/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:\"Name\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:profileData===null||profileData===void 0?void 0:profileData.name}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:/*#__PURE__*/_jsx(EditProfile,{data:profileData,onRefresh:getProfileDetails})})]}),/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:\"Email\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:profileData===null||profileData===void 0?void 0:profileData.email}),/*#__PURE__*/_jsx(TableCell,{align:\"right\"})]}),/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:\"Admin Type\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:profileData===null||profileData===void 0?void 0:profileData.user_type}),/*#__PURE__*/_jsx(TableCell,{align:\"right\"})]}),/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{align:\"left\",children:\"Password\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"**********\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:/*#__PURE__*/_jsx(ChangePassword,{onRefresh:getProfileDetails})})]})]})})]}),isLoading&&/*#__PURE__*/_jsx(\"div\",{className:classes.insidePaperDivStyle,children:/*#__PURE__*/_jsx(CircularProgress,{className:classes.lColor})})]})}),/*#__PURE__*/_jsx(Grid,{xs:true,md:true,item:true})]})]});};var initialEditValues={name:'',image:{file:null,prevImage:'',isNew:null}};export var EditProfile=function EditProfile(props){var data=props.data,onRefresh=props.onRefresh;var classes=useStyle();var formikRef=React.useRef(null);var imageRef=React.useRef(null);var _useService2=useService(),Post=_useService2.Post;var Snackbar=useSnackbar();var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEdit=_React$useState6[0],setIsEdit=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isOpen=_React$useState8[0],setIsOpen=_React$useState8[1];var _React$useState9=React.useState(_objectSpread({},initialEditValues)),_React$useState10=_slicedToArray(_React$useState9,2),initialFormValues=_React$useState10[0],setInitialFormValues=_React$useState10[1];React.useEffect(function(){if(isEdit){var image=data.image,_id=data._id,rest=_objectWithoutProperties(data,[\"image\",\"_id\"]);var editData=_objectSpread(_objectSpread({},rest),{},{id:_id});editData.image={file:image,prevImage:image===null||image===void 0?void 0:image.url,isNew:false};console.log(editData);setInitialFormValues(editData);}else{setInitialFormValues(initialEditValues);}},[props,isEdit]);var editProfileModel=function editProfileModel(){setIsOpen(!isOpen);setIsEdit(true);};var onClose=function onClose(){setIsOpen(!isOpen);};var onImageChange=function onImageChange(e){e.persist();var files=e.target.files;if(files&&files.length!=0){var reader=new FileReader();var file=files[0];reader.onloadend=function(){formikRef.current.setFieldValue('image',{file:file,prevImage:reader.result,isNew:true});};reader.readAsDataURL(file);}// else {\n//   formikRef.current.setFieldValue('image', {\n//     file: null,\n//     prevImage: '',\n//     isNew: null\n//   });\n// }\n};var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(value,helper){var name,image,postData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:name=value.name,image=value.image;postData={};postData.name=name;_context.next=5;return uploadNewImage(image);case 5:postData.image=_context.sent;editProfile(postData,helper);case 7:case\"end\":return _context.stop();}}},_callee);}));return function onSubmit(_x,_x2){return _ref.apply(this,arguments);};}();var editProfile=function editProfile(data,_ref2){var setSubmitting=_ref2.setSubmitting,resetForm=_ref2.resetForm;Post('app/updateAdminDetails',data).then(function(res){Snackbar.show(res.message,'success');setSubmitting(false);resetForm();onClose();onRefresh();}).catch(function(err){Snackbar.show(err.message,'error');});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:editProfileModel,className:classes.themeButton,children:/*#__PURE__*/_jsx(EditIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsxs(Dialog,{open:isOpen,disableBackdropClick:true,disableEscapeKeyDown:true,fullWidth:true,maxWidth:\"sm\",\"aria-labelledby\":\"dialog-title\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"dialog-title\",onClose:onClose,children:\"Edit Profile\"}),/*#__PURE__*/_jsx(Formik,{innerRef:formikRef,enableReinitialize:true,initialValues:initialFormValues,validationSchema:Yup.object().shape({name:Yup.string().required('Name is required'),image:Yup.object({file:Yup.mixed().required('A file is required')})}),onSubmit:onSubmit,children:function children(_ref3){var _values$image;var values=_ref3.values,errors=_ref3.errors,touched=_ref3.touched,handleChange=_ref3.handleChange,handleBlur=_ref3.handleBlur,setFieldValue=_ref3.setFieldValue,submitForm=_ref3.submitForm,isSubmitting=_ref3.isSubmitting;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(\"input\",{name:\"recipe_image\",ref:imageRef,type:\"file\",accept:\".jpg,.png,jpeg\",onChange:onImageChange,onBlur:handleBlur,hidden:true}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center'},children:/*#__PURE__*/_jsx(Avatar,{onClick:function onClick(){return imageRef.current.click();},className:classes.avatarStyle,src:values===null||values===void 0?void 0:(_values$image=values.image)===null||_values$image===void 0?void 0:_values$image.prevImage,alt:'profilePic',variant:\"square\"})})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Name\",variant:\"outlined\",name:\"name\",value:values.name,onBlur:handleBlur,onChange:handleChange,error:Boolean(touched.name&&errors.name),helperText:touched.name&&errors.name})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:onClose,variant:\"outlined\",color:\"secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{className:classes.themeButton,onClick:function onClick(){return submitForm();},disabled:isSubmitting,variant:\"outlined\",children:isSubmitting?/*#__PURE__*/_jsx(CircularProgress,{size:24,style:{color:'white'}}):'Save'})]})]});}})]})]});};var initialValues={password:'',confirmPassword:''};export var ChangePassword=function ChangePassword(props){var onRefresh=props.onRefresh;var classes=useStyle();var formikRef=React.useRef(null);var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isOpen=_React$useState12[0],setIsOpen=_React$useState12[1];var _useService3=useService(),Post=_useService3.Post;var Snackbar=useSnackbar();var _React$useState13=React.useState(_objectSpread({},initialValues)),_React$useState14=_slicedToArray(_React$useState13,2),initialFormValues=_React$useState14[0],setInitialFormValues=_React$useState14[1];var changePasswordModel=function changePasswordModel(){setIsOpen(!isOpen);};var onClose=function onClose(){setIsOpen(!isOpen);};var onSubmit=function onSubmit(value,helper){var confirmPassword=value.confirmPassword;var postData={password:confirmPassword};changePasswordData(postData,helper);};var changePasswordData=function changePasswordData(data,_ref4){var setSubmitting=_ref4.setSubmitting,resetForm=_ref4.resetForm;Post('app/updateAdminPassword',data).then(function(res){if(res.error){Snackbar.show(res.message,'success');setSubmitting(false);}else{Snackbar.show(res.message,'success');setSubmitting(false);resetForm();onClose();onRefresh();}}).catch(function(err){setSubmitting(false);Snackbar.show(err.message,'error');});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:changePasswordModel,className:classes.themeButton,children:\"Change\"}),/*#__PURE__*/_jsxs(Dialog,{open:isOpen,disableBackdropClick:true,disableEscapeKeyDown:true,fullWidth:true,maxWidth:\"sm\",\"aria-labelledby\":\"dialog-title\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"dialog-title\",onClose:onClose,children:\"Change Password\"}),/*#__PURE__*/_jsx(Formik,{innerRef:formikRef,enableReinitialize:true,initialValues:initialFormValues,validationSchema:Yup.object().shape({password:Yup.string().required('Password is required').min(6,'Password must be at least 6 characters'),confirmPassword:Yup.string().oneOf([Yup.ref('password'),null],'Password must be same').required('Confirm password is required')}),onSubmit:onSubmit,children:function children(_ref5){var values=_ref5.values,errors=_ref5.errors,touched=_ref5.touched,handleChange=_ref5.handleChange,handleBlur=_ref5.handleBlur,setFieldValue=_ref5.setFieldValue,submitForm=_ref5.submitForm,isSubmitting=_ref5.isSubmitting;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"New Password\",variant:\"outlined\",name:\"password\",type:\"password\",value:values.password,onBlur:handleBlur,onChange:handleChange,error:Boolean(touched.password&&errors.password),helperText:touched.password&&errors.password})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Confirm Password\",variant:\"outlined\",name:\"confirmPassword\",type:\"password\",value:values.confirmPassword,onBlur:handleBlur,onChange:handleChange,error:Boolean(touched.confirmPassword&&errors.confirmPassword),helperText:touched.confirmPassword&&errors.confirmPassword})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:onClose,variant:\"outlined\",color:\"secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{className:classes.themeButton,onClick:function onClick(){return submitForm();},disabled:isSubmitting,variant:\"outlined\",children:isSubmitting?/*#__PURE__*/_jsx(CircularProgress,{size:24,style:{color:'white'}}):'Submit'})]})]});}})]})]});};export default AdminProfileDetails;","map":null,"metadata":{},"sourceType":"module"}