{"ast":null,"code":"import _objectSpread from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import moment from'moment';import{makeStyles}from'@material-ui/styles';import{Card,CardHeader,CardContent,Avatar,Typography,Divider,Input,Paper,Tooltip,IconButton,CircularProgress}from'@material-ui/core';import AccessTimeIcon from'@material-ui/icons/AccessTime';import SendIcon from'@material-ui/icons/Send';import useService from'../../hook/useService';import useSnackbar from'../../hook/useSnackbar';import{Pagination}from'@material-ui/lab';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{root:{},subheader:{display:'flex',alignItems:'center'},accessTimeIcon:{color:theme.palette.text.secondary,fontSize:'14px',height:14,width:14,marginRight:6},content:{paddingTop:0},message:{marginBottom:theme.spacing(2)},divider:{marginTop:theme.spacing(2),marginBottom:theme.spacing(2)},replayInsertDiv:{display:'flex',alignItems:'center'},paper:{flexGrow:1,marginLeft:theme.spacing(2),padding:theme.spacing(0.5,2)},input:{width:'100%'},replayListDiv:{display:'flex',marginBottom:theme.spacing(2)},bubble:{flexGrow:1,padding:theme.spacing(1),marginLeft:theme.spacing(2),borderRadius:theme.shape.borderRadius,backgroundColor:theme.palette.background.default},header:{display:'flex',alignItems:'center'},time:{marginLeft:'auto'},replayMessage:{marginTop:theme.spacing(1)},actions:{display:'flex',padding:theme.spacing(2,1),justifyContent:'center'},lColor:{color:theme.palette.green.main}};});var AppUserFeedback=function AppUserFeedback(props){var classes=useStyles();var data=props.data;var _useService=useService(),Post=_useService.Post;var Snackbar=useSnackbar();// const ConfModel = useConfModel();\nvar _useState=useState({page_no:1,page_limit:10,id:''}),_useState2=_slicedToArray(_useState,2),stateData=_useState2[0],setStateData=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),pageCount=_useState4[0],setPageCount=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),dataList=_useState6[0],setDataList=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var listFeedback=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var data,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:data=_args.length>0&&_args[0]!==undefined?_args[0]:stateData;setLoading(true);Post('app/listFeedback',data).then(function(res){console.log('listFeedback',res);setLoading(false);if(!res.error){setDataList(res.data);setPageCount(res.page_count);}else{Snackbar.show(res.message,'error');}}).catch(function(err){console.log('err',err);setLoading(false);Snackbar.show(err.message,'error');});case 3:case\"end\":return _context.stop();}}},_callee);}));return function listFeedback(){return _ref.apply(this,arguments);};}();var onPageChange=function onPageChange(event,value){setStateData(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{page_no:value});});listFeedback(_objectSpread(_objectSpread({},stateData),{},{page_no:value}));};useEffect(function(){setStateData(function(prevData){return _objectSpread(_objectSpread({},prevData),{},{id:data._id});});listFeedback(_objectSpread(_objectSpread({},stateData),{},{id:data._id}));},[props]);return/*#__PURE__*/_jsxs(_Fragment,{children:[!loading&&dataList.map(function(data,index){return/*#__PURE__*/_jsx(FeedbackCard,{data:data});}),loading&&/*#__PURE__*/_jsx(\"div\",{className:classes.actions,children:/*#__PURE__*/_jsx(CircularProgress,{className:classes.lColor})}),!loading&&dataList.length==0&&/*#__PURE__*/_jsx(\"div\",{className:classes.actions,children:\"No Feedback\"}),/*#__PURE__*/_jsx(\"div\",{className:classes.actions,children:/*#__PURE__*/_jsx(Pagination,{count:pageCount,page:stateData.page_no,onChange:onPageChange})})]});};var FeedbackCard=function FeedbackCard(props){var classes=useStyles();var data=props.data;var _useService2=useService(),Post=_useService2.Post;var Snackbar=useSnackbar();var _useState9=useState(data),_useState10=_slicedToArray(_useState9,2),formData=_useState10[0],setFormData=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),replayText=_useState12[0],setReplayText=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),loading=_useState14[0],setLoading=_useState14[1];var replaySubmit=function replaySubmit(){setLoading(true);Post('app/postReplay',{id:formData._id,replay:replayText}).then(function(res){console.log('postReplay',res);setLoading(false);formData.replay.push(res.data);setFormData(function(prevState){return formData;});setReplayText('');}).catch(function(err){console.log('err',err);setLoading(false);Snackbar.show(err.message,'error');});};var handleReplayChange=function handleReplayChange(e){setReplayText(e.target.value);};useEffect(function(){setFormData(data);},[props]);return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{avatar:/*#__PURE__*/_jsx(Avatar,{alt:formData===null||formData===void 0?void 0:formData.name,src:formData===null||formData===void 0?void 0:formData.profilePic}),disableTypography:true,subheader:/*#__PURE__*/_jsxs(\"div\",{className:classes.subheader,children:[/*#__PURE__*/_jsx(AccessTimeIcon,{className:classes.accessTimeIcon}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:moment(formData===null||formData===void 0?void 0:formData.created_at).fromNow()})]}),title:formData===null||formData===void 0?void 0:formData.name}),/*#__PURE__*/_jsxs(CardContent,{className:classes.content,children:[/*#__PURE__*/_jsx(Typography,{className:classes.message,variant:\"body1\",children:formData===null||formData===void 0?void 0:formData.feedback}),!((formData===null||formData===void 0?void 0:formData.replay.length)==0)&&/*#__PURE__*/_jsx(Divider,{className:classes.divider}),(formData===null||formData===void 0?void 0:formData.replay)&&(formData===null||formData===void 0?void 0:formData.replay.map(function(data,index){return/*#__PURE__*/_jsx(FeedbackReplayCard,{data:data},index);})),/*#__PURE__*/_jsx(Divider,{className:classes.divider}),/*#__PURE__*/_jsxs(\"div\",{className:classes.replayInsertDiv,children:[/*#__PURE__*/_jsx(Paper,{className:classes.paper,elevation:1,children:/*#__PURE__*/_jsx(Input,{value:replayText,className:classes.input,disableUnderline:true,onChange:handleReplayChange,placeholder:\"Leave a replay\"})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Send\",children:/*#__PURE__*/_jsx(IconButton,{color:\"primary\",disabled:loading,onClick:replaySubmit,children:/*#__PURE__*/_jsx(SendIcon,{})})})]})]})]});};var FeedbackReplayCard=/*#__PURE__*/React.memo(function(props){var classes=useStyles();var data=props.data;var _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),formData=_useState16[0],setFormData=_useState16[1];useEffect(function(){console.log('data',data);setFormData(data);},[props]);return/*#__PURE__*/_jsxs(\"div\",{className:classes.replayListDiv,children:[/*#__PURE__*/_jsx(Avatar,{alt:formData===null||formData===void 0?void 0:formData.replay_by_name,src:formData===null||formData===void 0?void 0:formData.replay_by_image}),/*#__PURE__*/_jsxs(\"div\",{className:classes.bubble,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.header,children:[/*#__PURE__*/_jsx(Typography,{color:\"textPrimary\",variant:\"h6\",children:formData===null||formData===void 0?void 0:formData.replay_by_name}),/*#__PURE__*/_jsx(Typography,{className:classes.time,variant:\"body2\",children:moment(formData===null||formData===void 0?void 0:formData.created_at).fromNow()})]}),/*#__PURE__*/_jsx(Typography,{className:classes.replayMessage,variant:\"body1\",children:formData===null||formData===void 0?void 0:formData.feedback_replay})]})]});});export default AppUserFeedback;","map":null,"metadata":{},"sourceType":"module"}