{"ast":null,"code":"import _toConsumableArray from \"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { isNodeSelection, posToDOMRect, Extension } from '@tiptap/core';\nimport { PluginKey, Plugin } from 'prosemirror-state';\nimport tippy from 'tippy.js';\n\nvar BubbleMenuView = /*#__PURE__*/function () {\n  function BubbleMenuView(_ref) {\n    var _this = this;\n\n    var editor = _ref.editor,\n        element = _ref.element,\n        view = _ref.view,\n        tippyOptions = _ref.tippyOptions;\n\n    _classCallCheck(this, BubbleMenuView);\n\n    this.preventHide = false;\n\n    this.mousedownHandler = function () {\n      _this.preventHide = true;\n    };\n\n    this.focusHandler = function () {\n      // we use `setTimeout` to make sure `selection` is already updated\n      setTimeout(function () {\n        return _this.update(_this.editor.view);\n      });\n    };\n\n    this.blurHandler = function (_ref2) {\n      var event = _ref2.event;\n\n      var _a;\n\n      if (_this.preventHide) {\n        _this.preventHide = false;\n        return;\n      }\n\n      if ((event === null || event === void 0 ? void 0 : event.relatedTarget) && ((_a = _this.element.parentNode) === null || _a === void 0 ? void 0 : _a.contains(event.relatedTarget))) {\n        return;\n      }\n\n      _this.hide();\n    };\n\n    this.editor = editor;\n    this.element = element;\n    this.view = view;\n    this.element.addEventListener('mousedown', this.mousedownHandler, {\n      capture: true\n    });\n    this.editor.on('focus', this.focusHandler);\n    this.editor.on('blur', this.blurHandler);\n    this.createTooltip(tippyOptions);\n    this.element.style.visibility = 'visible';\n  }\n\n  _createClass(BubbleMenuView, [{\n    key: \"createTooltip\",\n    value: function createTooltip() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      this.tippy = tippy(this.view.dom, _objectSpread({\n        duration: 0,\n        getReferenceClientRect: null,\n        content: this.element,\n        interactive: true,\n        trigger: 'manual',\n        placement: 'top',\n        hideOnClick: 'toggle'\n      }, options));\n    }\n  }, {\n    key: \"update\",\n    value: function update(view, oldState) {\n      var state = view.state,\n          composing = view.composing;\n      var doc = state.doc,\n          selection = state.selection;\n      var isSame = oldState && oldState.doc.eq(doc) && oldState.selection.eq(selection);\n\n      if (composing || isSame) {\n        return;\n      }\n\n      var empty = selection.empty,\n          $anchor = selection.$anchor,\n          ranges = selection.ranges; // support for CellSelections\n\n      var from = Math.min.apply(Math, _toConsumableArray(ranges.map(function (range) {\n        return range.$from.pos;\n      })));\n      var to = Math.max.apply(Math, _toConsumableArray(ranges.map(function (range) {\n        return range.$to.pos;\n      }))); // Sometime check for `empty` is not enough.\n      // Doubleclick an empty paragraph returns a node size of 2.\n      // So we check also for an empty text size.\n\n      if (empty || !$anchor.parent.textContent) {\n        this.hide();\n        return;\n      }\n\n      this.tippy.setProps({\n        getReferenceClientRect: function getReferenceClientRect() {\n          if (isNodeSelection(view.state.selection)) {\n            var node = view.nodeDOM(from);\n\n            if (node) {\n              return node.getBoundingClientRect();\n            }\n          }\n\n          return posToDOMRect(view, from, to);\n        }\n      });\n      this.show();\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      this.tippy.show();\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.tippy.hide();\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.tippy.destroy();\n      this.element.removeEventListener('mousedown', this.mousedownHandler);\n      this.editor.off('focus', this.focusHandler);\n      this.editor.off('blur', this.blurHandler);\n    }\n  }]);\n\n  return BubbleMenuView;\n}();\n\nvar BubbleMenuPluginKey = new PluginKey('menuBubble');\n\nvar BubbleMenuPlugin = function BubbleMenuPlugin(options) {\n  return new Plugin({\n    key: BubbleMenuPluginKey,\n    view: function view(_view) {\n      return new BubbleMenuView(_objectSpread({\n        view: _view\n      }, options));\n    }\n  });\n};\n\nvar BubbleMenu = Extension.create({\n  name: 'bubbleMenu',\n  defaultOptions: {\n    element: null,\n    tippyOptions: {}\n  },\n  addProseMirrorPlugins: function addProseMirrorPlugins() {\n    if (!this.options.element) {\n      return [];\n    }\n\n    return [BubbleMenuPlugin({\n      editor: this.editor,\n      element: this.options.element,\n      tippyOptions: this.options.tippyOptions\n    })];\n  }\n});\nexport default BubbleMenu;\nexport { BubbleMenu, BubbleMenuPlugin, BubbleMenuPluginKey, BubbleMenuView };","map":{"version":3,"sources":["../src/bubble-menu-plugin.ts","../src/bubble-menu.ts"],"names":[],"mappings":"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","sourcesContent":["import { Editor, posToDOMRect, isNodeSelection } from '@tiptap/core'\nimport { EditorState, Plugin, PluginKey } from 'prosemirror-state'\nimport { EditorView } from 'prosemirror-view'\nimport tippy, { Instance, Props } from 'tippy.js'\n\nexport interface BubbleMenuPluginProps {\n  editor: Editor,\n  element: HTMLElement,\n  tippyOptions?: Partial<Props>,\n}\n\nexport type BubbleMenuViewProps = BubbleMenuPluginProps & {\n  view: EditorView,\n}\n\nexport class BubbleMenuView {\n  public editor: Editor\n\n  public element: HTMLElement\n\n  public view: EditorView\n\n  public preventHide = false\n\n  public tippy!: Instance\n\n  constructor({\n    editor,\n    element,\n    view,\n    tippyOptions,\n  }: BubbleMenuViewProps) {\n    this.editor = editor\n    this.element = element\n    this.view = view\n    this.element.addEventListener('mousedown', this.mousedownHandler, { capture: true })\n    this.editor.on('focus', this.focusHandler)\n    this.editor.on('blur', this.blurHandler)\n    this.createTooltip(tippyOptions)\n    this.element.style.visibility = 'visible'\n  }\n\n  mousedownHandler = () => {\n    this.preventHide = true\n  }\n\n  focusHandler = () => {\n    // we use `setTimeout` to make sure `selection` is already updated\n    setTimeout(() => this.update(this.editor.view))\n  }\n\n  blurHandler = ({ event }: { event: FocusEvent }) => {\n    if (this.preventHide) {\n      this.preventHide = false\n\n      return\n    }\n\n    if (\n      event?.relatedTarget\n      && this.element.parentNode?.contains(event.relatedTarget as Node)\n    ) {\n      return\n    }\n\n    this.hide()\n  }\n\n  createTooltip(options: Partial<Props> = {}) {\n    this.tippy = tippy(this.view.dom, {\n      duration: 0,\n      getReferenceClientRect: null,\n      content: this.element,\n      interactive: true,\n      trigger: 'manual',\n      placement: 'top',\n      hideOnClick: 'toggle',\n      ...options,\n    })\n  }\n\n  update(view: EditorView, oldState?: EditorState) {\n    const { state, composing } = view\n    const { doc, selection } = state\n    const isSame = oldState && oldState.doc.eq(doc) && oldState.selection.eq(selection)\n\n    if (composing || isSame) {\n      return\n    }\n\n    const { empty, $anchor, ranges } = selection\n\n    // support for CellSelections\n    const from = Math.min(...ranges.map(range => range.$from.pos))\n    const to = Math.max(...ranges.map(range => range.$to.pos))\n\n    // Sometime check for `empty` is not enough.\n    // Doubleclick an empty paragraph returns a node size of 2.\n    // So we check also for an empty text size.\n    if (empty || !$anchor.parent.textContent) {\n      this.hide()\n\n      return\n    }\n\n    this.tippy.setProps({\n      getReferenceClientRect: () => {\n        if (isNodeSelection(view.state.selection)) {\n          const node = view.nodeDOM(from) as HTMLElement\n\n          if (node) {\n            return node.getBoundingClientRect()\n          }\n        }\n\n        return posToDOMRect(view, from, to)\n      },\n    })\n\n    this.show()\n  }\n\n  show() {\n    this.tippy.show()\n  }\n\n  hide() {\n    this.tippy.hide()\n  }\n\n  destroy() {\n    this.tippy.destroy()\n    this.element.removeEventListener('mousedown', this.mousedownHandler)\n    this.editor.off('focus', this.focusHandler)\n    this.editor.off('blur', this.blurHandler)\n  }\n}\n\nexport const BubbleMenuPluginKey = new PluginKey('menuBubble')\n\nexport const BubbleMenuPlugin = (options: BubbleMenuPluginProps) => {\n  return new Plugin({\n    key: BubbleMenuPluginKey,\n    view: view => new BubbleMenuView({ view, ...options }),\n  })\n}\n","import { Extension } from '@tiptap/core'\nimport { BubbleMenuPlugin, BubbleMenuPluginProps } from './bubble-menu-plugin'\n\nexport type BubbleMenuOptions = Omit<BubbleMenuPluginProps, 'editor' | 'element'> & {\n  element: HTMLElement | null,\n}\n\nexport const BubbleMenu = Extension.create<BubbleMenuOptions>({\n  name: 'bubbleMenu',\n\n  defaultOptions: {\n    element: null,\n    tippyOptions: {},\n  },\n\n  addProseMirrorPlugins() {\n    if (!this.options.element) {\n      return []\n    }\n\n    return [\n      BubbleMenuPlugin({\n        editor: this.editor,\n        element: this.options.element,\n        tippyOptions: this.options.tippyOptions,\n      }),\n    ]\n  },\n})\n"]},"metadata":{},"sourceType":"module"}