{"ast":null,"code":"import _toConsumableArray from \"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:/Pyramidion/WebApp/Izze-Admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { isNodeSelection, posToDOMRect, Extension } from '@tiptap/core';\nimport { PluginKey, Plugin } from 'prosemirror-state';\nimport tippy from 'tippy.js';\n\nvar BubbleMenuView = /*#__PURE__*/function () {\n  function BubbleMenuView(_ref) {\n    var _this = this;\n\n    var editor = _ref.editor,\n        element = _ref.element,\n        view = _ref.view,\n        tippyOptions = _ref.tippyOptions;\n\n    _classCallCheck(this, BubbleMenuView);\n\n    this.preventHide = false;\n\n    this.mousedownHandler = function () {\n      _this.preventHide = true;\n    };\n\n    this.focusHandler = function () {\n      // we use `setTimeout` to make sure `selection` is already updated\n      setTimeout(function () {\n        return _this.update(_this.editor.view);\n      });\n    };\n\n    this.blurHandler = function (_ref2) {\n      var event = _ref2.event;\n\n      var _a;\n\n      if (_this.preventHide) {\n        _this.preventHide = false;\n        return;\n      }\n\n      if ((event === null || event === void 0 ? void 0 : event.relatedTarget) && ((_a = _this.element.parentNode) === null || _a === void 0 ? void 0 : _a.contains(event.relatedTarget))) {\n        return;\n      }\n\n      _this.hide();\n    };\n\n    this.editor = editor;\n    this.element = element;\n    this.view = view;\n    this.element.addEventListener('mousedown', this.mousedownHandler, {\n      capture: true\n    });\n    this.editor.on('focus', this.focusHandler);\n    this.editor.on('blur', this.blurHandler);\n    this.createTooltip(tippyOptions);\n    this.element.style.visibility = 'visible';\n  }\n\n  _createClass(BubbleMenuView, [{\n    key: \"createTooltip\",\n    value: function createTooltip() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      this.tippy = tippy(this.view.dom, _objectSpread({\n        duration: 0,\n        getReferenceClientRect: null,\n        content: this.element,\n        interactive: true,\n        trigger: 'manual',\n        placement: 'top',\n        hideOnClick: 'toggle'\n      }, options));\n    }\n  }, {\n    key: \"update\",\n    value: function update(view, oldState) {\n      var state = view.state,\n          composing = view.composing;\n      var doc = state.doc,\n          selection = state.selection;\n      var isSame = oldState && oldState.doc.eq(doc) && oldState.selection.eq(selection);\n\n      if (composing || isSame) {\n        return;\n      }\n\n      var empty = selection.empty,\n          $anchor = selection.$anchor,\n          ranges = selection.ranges; // support for CellSelections\n\n      var from = Math.min.apply(Math, _toConsumableArray(ranges.map(function (range) {\n        return range.$from.pos;\n      })));\n      var to = Math.max.apply(Math, _toConsumableArray(ranges.map(function (range) {\n        return range.$to.pos;\n      }))); // Sometime check for `empty` is not enough.\n      // Doubleclick an empty paragraph returns a node size of 2.\n      // So we check also for an empty text size.\n\n      if (empty || !$anchor.parent.textContent) {\n        this.hide();\n        return;\n      }\n\n      this.tippy.setProps({\n        getReferenceClientRect: function getReferenceClientRect() {\n          if (isNodeSelection(view.state.selection)) {\n            var node = view.nodeDOM(from);\n\n            if (node) {\n              return node.getBoundingClientRect();\n            }\n          }\n\n          return posToDOMRect(view, from, to);\n        }\n      });\n      this.show();\n    }\n  }, {\n    key: \"show\",\n    value: function show() {\n      this.tippy.show();\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.tippy.hide();\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.tippy.destroy();\n      this.element.removeEventListener('mousedown', this.mousedownHandler);\n      this.editor.off('focus', this.focusHandler);\n      this.editor.off('blur', this.blurHandler);\n    }\n  }]);\n\n  return BubbleMenuView;\n}();\n\nvar BubbleMenuPluginKey = new PluginKey('menuBubble');\n\nvar BubbleMenuPlugin = function BubbleMenuPlugin(options) {\n  return new Plugin({\n    key: BubbleMenuPluginKey,\n    view: function view(_view) {\n      return new BubbleMenuView(_objectSpread({\n        view: _view\n      }, options));\n    }\n  });\n};\n\nvar BubbleMenu = Extension.create({\n  name: 'bubbleMenu',\n  defaultOptions: {\n    element: null,\n    tippyOptions: {}\n  },\n  addProseMirrorPlugins: function addProseMirrorPlugins() {\n    if (!this.options.element) {\n      return [];\n    }\n\n    return [BubbleMenuPlugin({\n      editor: this.editor,\n      element: this.options.element,\n      tippyOptions: this.options.tippyOptions\n    })];\n  }\n});\nexport default BubbleMenu;\nexport { BubbleMenu, BubbleMenuPlugin, BubbleMenuPluginKey, BubbleMenuView };","map":null,"metadata":{},"sourceType":"module"}